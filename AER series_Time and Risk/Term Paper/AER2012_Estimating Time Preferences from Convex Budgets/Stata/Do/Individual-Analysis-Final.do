log on/***** Individual Analysis Final.do: Individual Anaylsis ********//* This do file is called by doanaylsis.do and has 2 components.Part 1: Individual Estimates generating: - Appendix Tables A2-A5 of individual estimates. - Table 4: Summary of individual estimates.Part 2: Comparison to DMPL data and corresponding statistics.*/log offlog on/*** Part 1: Individual Estimates ****//*******************************//* Individual Level Estimates *//* Appendix Tables A6- A7 */log offcapture drop alphaicapture drop betaicapture drop deltaicapture drop convergeicapture drop rateigen alphai = .gen betai = .gen deltai = .gen convergei = .gen ratei = .log onforvalues i = 1(1)97 {estimates clearreturn clearqui replace convergei = -100 if labnumber == `i'capture drop gammarestrictgen gammarestrict = 0qui capture nl (cons1= (((1 - (({beta=1}*{delta=1}^k)*(pratio))^(1/({alpha = 0.7} - 1)))*gammarestrict) + ((({beta=1}*{delta=1}^k)*(pratio))^(1/({alpha = 0.7} -1 )))*mnumer )/(( 1+ ((pratio)^({alpha = 0.7}/({alpha= 0.7} -1)))*(({beta=1}*{delta = 1}^k)^(1/({alpha= 0.7} -1 )) )))*t0     +       (((1 - (({delta=1}^k)*(pratio))^(1/({alpha = 0.7} - 1)))*gammarestrict) + ((({delta=1}^k)*(pratio))^(1/({alpha = 0.7} -1 )))*mnumer )/(( 1+ ((pratio)^({alpha = 0.7}/({alpha= 0.7} -1)))*(({delta = 1}^k)^(1/({alpha= 0.7} -1 )) )))*(1-t0)) if labnumber == `i',  iter(75) eps(1e-5) tracequi replace convergei = e(converge) if labnumber == `i'qui capture nlcom (yearrate: 1/_b[/delta]^365 - 1)  (beta:_b[/beta]) (alpha: _b[/alpha]) (delta: _b[/delta])matrix tempmat = r(b)qui replace ratei = tempmat[1,1] if labnumber == `i'local rateest = round(tempmat[1,1], .001)qui replace betai = tempmat[1,2] if labnumber == `i'local betaest = round(tempmat[1,2], .001)qui replace alphai = tempmat[1,3] if labnumber == `i'local alphaest = round(tempmat[1,3], .001)qui replace deltai = tempmat[1,4] if labnumber == `i'local deltaest = round(tempmat[1,4], .001)qui su interior if labnumber == `i'local interiorper = round(r(mean), .01)qui su patient if labnumber == `i'local patientper = round(r(mean), .01)qui su impatient if labnumber == `i'local impatientper = round(r(mean), .01)disp `i' "&" `rateest' " & " `betaest' " & " `alphaest' " & " `interiorper' " & " `patientper' " & " `impatientper' "\\"}log off/* Note: the remainder of the analysis requires only 1 observation per person */drop if obscount != 1log on/* ATTENTION *//* Dropping Out Observations here *//* Drop out zero variance guys */drop if sdc == 0 /* Drop out unconverged guys */drop if convergei != 1/* Drop Out Individual 84 (4,3,2,1,0 pattern) */drop if labnumber == 84/*** End Part 1 ****/log offlog on/*** Part 2: Comparison to DMPL ***/log off/* Figure 4 *//* Panel A: Discount Factors *//* Get daily discount factors for those with no inconsistencies in the MPLs */capture drop avrgdiscount2gen avrgdiscount2 = avrgdiscountreplace avrgdiscount2 = . if incpl1 == 1 | incpl2 == 1 | incpl3 == 1log on/*** Table 4 ****/local biglist "ratei deltai betai alphai"foreach x of local biglist {qui sum `x'  , detdisp "`x'" " & " r(N) " & " round(r(p50), .0001) " & [" round(r(p5), .0001) " , " round(r(p95), .0001) "] & [" round(r(min), .0001) " / " round(r(max), .0001) "] \\"  }log off /* Graph Panel A: Discounting */twoway (scatter deltai avrgdiscount2, msize(medium)) (lfit deltai avrgdiscount2, lpattern(solid) color(black)) (scatteri 0.99 0.99 1.004 1.004, recast(line) lcolor(black) lpattern(dash)), ytitle("Estimated Daily Discount Factor (delta)") ylabel(0.99(.004)1.014, angle(horizontal)) xtitle("Calculated Daily Discount Factor (d)") xlabel(0.99(.004)1.002) title(Panel A: Daily Discount Factors) subtitle(N = 84) legend(order(2 "Regression Line" "rho = 0.420" "(p < .001)" 3 "45 Deg Line") cols(1)) scheme(S1mono)graph save "Figures/deltagraph", replace/* Unused Present Bias Graph*/capture drop meanbeta sdbeta betahigh betalow numegen meanbeta = mean(betai) if avrgdiscount2 != ., by(presentbias13)egen sdbeta = sd(betai) if avrgdiscount2 != ., by(presentbias13)bysort presentbias13: gen num = _Ngen betahigh = meanbeta +1.96*sdbeta/sqrt(num)gen betalow = meanbeta - 1.96*sdbeta/sqrt(num)capture label drop pblablabel define pblab 0 "Present Bias = 0" 1 "Present Bias = 1"label values presentbias13 pblabtwoway (bar meanbeta presentbias13, fcolor(gs0) lcolor(black) barwidth(0.6)) (rcap betalow betahigh presentbias13, lcolor(black) lwidth(medium) lpattern(solid)) , ytitle("Estimated Present Bias Parameter (beta)") ylabel(0.7(.05)1.1) xtitle("Calculated Present Bias") xlabel(0(1)1, valuelabel) scheme(s1mono) xsize(7) ysize(6) title(Panel B: Present Bias Parameters) subtitle("N = 85, t = 2.40, (p <.05)") legend(order(2 "+/- 1.96 s.e" ) row(1)) graph save "Figures/betagraph", replace/* Panel B: Curvature *//* Get average curvature parameter for those with no inconsistencies in the HLs */capture drop avrgalphacapture drop avrgalpha2gen avrgalpha = (alpha1mid + alpha2mid)/2 if alpha1mid != . & alpha2mid != .replace avrgalpha = alpha1mid if alpha2mid == .replace avrgalpha = alpha2mid if alpha1mid == .gen avrgalpha2 = avrgalphareplace avrgalpha2 = . if inchl1 == 1 | inchl2 == 1gen discountcurv = ((pl1/20)^(avrgalpha2/35) + (pl2/20)^(avrgalpha2/98) + (pl3/20)^(avrgalpha2/35) )/3
replace discountcurv = . if avrgdiscount2 == .gen ratecurv = (1/discountcurv^365) - 1
log on/* MPL Discounting adjusted for curvature */ su ratecurv, detpwcorr discountcurv ratecurv deltai ratei, sigpwcorr discountcurv ratecurv deltai ratei if discountcurv > 0.994, sig
log off
twoway (scatter deltai discountcurv if discountcurv >0.994, msize(medium)) (lfit deltai discountcurv if discountcurv > 0.994, lpattern(solid) color(black)) (scatteri 0.994 0.994 1.002 1.002, recast(line) lcolor(black) lpattern(dash)), ytitle("Estimated CTB Discount Factor (delta)") ylabel(0.994(.004)1.014, angle(horizontal)) xtitle("Calculated DMPL Discount Factor (d^a)") xlabel(0.994(.004)1.002) title(DMPL vs. CTB Discount Factors) subtitle(N = 76) legend(order(2 "Regression Line" "rho = 0.115" "(p = 0.337)" 3 "45 Deg Line") cols(1)) scheme(S1mono)graph export "Figures/discountcurvecompare.pdf", replace/* Graph Panel B and Save */twoway (scatter alphai avrgalpha2, msize(medium)) (lfit alphai avrgalpha2,lpattern(solid) color(black)) (scatteri -.25 -.25 1.25 1.25, recast(line) lcolor(black) lpattern(dash)), ytitle("Estimated Curvature Parameter (alpha)") ylabel(-.25(.25)1.75, angle(horizontal)) xtitle("Calculated Curvature Parameter (a)") xlabel(-.25(.25)1.25) title(Panel B: Curvature Parameters) subtitle(N = 77) legend(order(2 "Regression Line" "rho = 0.066" "(p = 0.568)"3 "45 Deg Line") cols(1)) scheme(S1mono)graph save "Figures/alphagraph", replace/* Combine the Graphs */graph combine "Figures/deltagraph.gph" "Figures/alphagraph.gph", rows(1)graph export "Figures/comparison.pdf", replacelog on /* Summary of DMPL data */sum avrgdiscount2, detsum beta13 if avrgdiscount2 != ., dettab presentbias13 if avrgdiscount2 != .sum avrgalpha2, detsu avrgdiscount2 beta13 presentbias13 deltai betai if avrgdiscount2 != .pwcorr avrgdiscount2 beta13 presentbias13 deltai betai if avrgdiscount2 != ., siglog offlog on/* Correlations used for Figure 4 and Text*/pwcorr deltai avrgdiscount2, sigpwcorr alphai avrgalpha2, sigpwcorr betai beta13 presentbias13 if avrgdiscount2 != ., siglog off/* Relationship between Curvature and bias*/capture drop biasgen bias = deltai - avrgdiscount2reg bias alphaiest store col1reg bias avrgalpha2 est store col2log on /* Relationship between Curvature and bias*/pwcorr bias alphai avrgalpha2, sigestout col1 col2, cells(b(fmt(%9.3f)) se(par fmt(%9.3f))) style(tex)  stats(N ll r2) log off/* Bias Graphic *//* To make the graphs comparable we graph the reasonable parameter estimates *//* The restriction to alphai > 0.55 doesn't graph three observations with alpha < 0.55 (no subst. changes)*/twoway (scatter bias alphai if alphai > 0.55 & avrgalpha2 != ., msize(medium)) (lfit bias alphai if alphai > 0.55 & avrgalpha2 != .,lpattern(solid) color(black)), ytitle("Estimated Bias (delta - d)")  xtitle("Estimated Curvature Parameter (alpha)")  legend(order(2 "Regression Line" "rho = -0.61 " "(p < .01)" ) cols(1)) scheme(s1mono)graph save "Figures/bias1", replacetwoway (scatter bias avrgalpha2 if alphai > 0.55 & avrgalpha2 != ., msize(medium)) (lfit bias avrgalpha2 if alphai > 0.55& avrgalpha2 != .,lpattern(solid) color(black)), ytitle("Estimated Bias (delta - d)")  xtitle("Calculated Curvature Parameter (a)")  legend(order(2 "Regression Line" "rho = 0.19 " "(p = .11)" ) cols(1)) scheme(s1mono)graph save "Figures/bias2", replacegraph combine "Figures/bias1.gph" "Figures/bias2.gph"graph export "Figures/bias.pdf", replace/* Simple Histograms */capture drop rateitempgen rateitemp = rateireplace rateitemp = 3 if ratei >= 3capture label drop ratelablabel define ratelab  3 ">=300%" 2 "200%" 1 "100%" 0 "0%" -1 "-100%"label values rateitemp ratelabhistogram rateitemp, width(0.15) percent xlabel(, valuelabel) xmtick(##5) xtitle("Estimated Annual Discount Rate") scheme(s2mono) title("Panel A: CTB")graph save "Figures/ratehist", replacehistogram deltai, width(0.00045) percent xlabel(, valuelabel) xmtick(##5) xtitle("Estimated Daily Discount Factor (delta)") scheme(s2mono)graph save "Figures/deltahist", replacehistogram betai, width(0.05) percent xlabel(, valuelabel) xmtick(##5) xtitle("Estimated Present Bias (beta)") scheme(s2mono)graph save "Figures/betahist", replacehistogram alphai, width(0.025) percent xlabel(, valuelabel) xmtick(##5) xtitle("Estimated Curvature Parameter (alpha)") scheme(s2mono)graph save "Figures/alphahist", replacegraph combine "Figures/ratehist.gph" "Figures/deltahist.gph" "Figures/betahist.gph" "Figures/alphahist.gph", ycommon cols(1)graph export "Figures/estimatedhist.pdf", replacecapture drop rateitemp2gen rateitemp2 = (1/avrgdiscount2^(365)) - 1replace rateitemp2 = 3 if rateitemp2 >= 3capture label drop ratelablabel define ratelab  3 ">=300%" 2 "200%" 1 "100%" 0 "0%" -1 "-100%"label values rateitemp2 ratelabhistogram rateitemp2, width(0.15) percent xlabel(, valuelabel) xmtick(##5) xtitle("Calculated Annual Discount Rate") scheme(s2mono) title("Panel B: DMPL")graph save "Figures/ratehist2", replacegraph combine "Figures/ratehist.gph" "Figures/ratehist2.gph", xcommon ycommon rows(1)graph save "Figures/bothrateshist", replacehistogram avrgdiscount2, width(0.00045) percent xlabel(, valuelabel) xmtick(##5) xtitle("Calculated Daily Discount Factor (d)") scheme(s2mono)graph save "Figures/deltahist2", replacegraph combine "Figures/deltahist.gph" "Figures/deltahist2.gph", xcommon ycommon rows(1)graph save "Figures/bothdeltashist", replacehistogram beta13, width(0.05) percent xlabel(, valuelabel) xmtick(##5) xtitle("Calculated Present Bias (b)") scheme(s2mono)graph save "Figures/betahist2", replacegraph combine "Figures/betahist.gph" "Figures/betahist2.gph", ycommon xcommon  rows(1)graph save "Figures/bothbetashist", replacehistogram avrgalpha2, width(0.025) percent xlabel(, valuelabel) xmtick(##5) xtitle("Calculated Curvature Parameter (a)") scheme(s2mono)graph save "Figures/alphahist2", replacegraph combine "Figures/alphahist.gph" "Figures/alphahist2.gph", xcommon ycommon rows(1)graph save "Figures/bothalphashist", replacegraph combine "Figures/bothrateshist.gph" "Figures/bothdeltashist.gph" "Figures/bothbetashist.gph" "Figures/bothalphashist.gph", ycommon cols(1)  ysize(11) xsize(8)graph export "Figures/bothhist.pdf", replace